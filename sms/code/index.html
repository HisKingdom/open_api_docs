<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Code - Convertlab 文档中心</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Code";
    var mkdocs_page_input_path = "sms/code.md";
    var mkdocs_page_url = "/sms/code/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Convertlab 文档中心</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">HOME</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">OPENAPI V1</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>网页埋点</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">Info</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../api/">API</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Code</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#python">Python</a></li>
                
            
                <li class="toctree-l3"><a href="#java">Java</a></li>
                
            
                <li class="toctree-l3"><a href="#php">PHP</a></li>
                
            
                <li class="toctree-l3"><a href="#ruby">Ruby</a></li>
                
            
                <li class="toctree-l3"><a href="#perl">Perl</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../test/doc/">TRY IT</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Convertlab 文档中心</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>网页埋点 &raquo;</li>
        
      
    
    <li>Code</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/xsio/open_api_docs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="python">Python</h3>
<pre><code>import requests
import json
import urllib
import time
from hashlib import md5

def generate_md5(fp):
    m = md5()    
    m.update(fp)
    return m.hexdigest()

url = 'http://sendcloud.sohu.com/smsapi/send'
SMS_KEY = '***'

param = {
    'smsUser':'***',
    'smsKey' : SMS_KEY,
    'templateId' : 1,
    'phone' : 13412345678,
    'vars' : '{&quot;%code%&quot;:&quot;123456&quot;}'
}

param_keys = list(param.keys())
param_keys.sort()

param_str = &quot;&quot;
for key in param_keys:
    param_str += key + '=' + str(param[key]) + '&amp;'
param_str = param_str[:-1]

sign_str = SMS_KEY + '&amp;' + param_str + '&amp;' + SMS_KEY
sign = generate_md5(sign_str)

param['signature'] = sign

res = requests.post(url,data=param)
print res.text

</code></pre>

<h3 id="java">Java</h3>
<p>代码示例需要依赖如下jar包</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
    &lt;version&gt;4.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
    &lt;artifactId&gt;httpmime&lt;/artifactId&gt;
    &lt;version&gt;4.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><a href="http://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient/4.2">httpclient</a>
<a href="http://mvnrepository.com/artifact/org.apache.httpcomponents/httpmime/4.2">httpmime</a></p>
<pre><code>public class SmsApi {

    public static void main(String[] args) {

        String url = &quot;http://sendcloud.sohu.com/smsapi/send&quot;;
        String smsKey = &quot;***&quot;;

        // 填充参数
        Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();
        params.put(&quot;smsUser&quot;, &quot;***&quot;);
        params.put(&quot;templateId&quot;, &quot;1&quot;);
        params.put(&quot;phone&quot;, &quot;13412345678&quot;);
        params.put(&quot;vars&quot;, &quot;{\&quot;code\&quot;:\&quot;123455\&quot;}&quot;);

        // 对参数进行排序
        Map&lt;String, String&gt; sortedMap = new TreeMap&lt;String, String&gt;(new Comparator&lt;String&gt;() {
            @Override
            public int compare(String arg0, String arg1) {
                // 忽略大小写
                return arg0.compareToIgnoreCase(arg1); 
            }
        });
        sortedMap.putAll(params);

        // 计算签名
        StringBuilder sb = new StringBuilder();
        sb.append(smsKey).append(&quot;&amp;&quot;);
        for (String s : sortedMap.keySet()) {
            sb.append(String.format(&quot;%s=%s&amp;&quot;, s, sortedMap.get(s)));
        }
        sb.append(smsKey);
        String sig = DigestUtils.md5Hex(sb.toString());

        // 将所有参数和签名添加到post请求参数数组里
        List&lt;NameValuePair&gt; postparams = new ArrayList&lt;NameValuePair&gt;();
        for (String s : sortedMap.keySet()) {
            postparams.add(new BasicNameValuePair(s, sortedMap.get(s)));
        }
        postparams.add(new BasicNameValuePair(&quot;signature&quot;, sig));

        HttpPost httpPost = new HttpPost(url);
        try {
            httpPost.setEntity(new UrlEncodedFormEntity(postparams, &quot;utf8&quot;));
            DefaultHttpClient httpclient = new DefaultHttpClient();
            httpclient.getParams().setIntParameter(CoreConnectionPNames.CONNECTION_TIMEOUT, 3000);
            httpclient.getParams().setIntParameter(CoreConnectionPNames.SO_TIMEOUT, 100000);
            HttpResponse response = httpclient.execute(httpPost);

            HttpEntity entity = response.getEntity();
            EntityUtils.consume(entity);
            System.out.println(EntityUtils.toString(response.getEntity()));
        } catch (Exception e) {
            System.out.println(e.toString());
        } finally {
            httpPost.releaseConnection();
        }
    }
}

</code></pre>

<h3 id="php">PHP</h3>
<pre><code>&lt;?php

function send_sms() {
        $url = 'http://sendcloud.sohu.com/smsapi/send';

        $param = array(
            'smsUser' =&gt; '***', 
            'templateId' =&gt; '1',
            'phone' =&gt; '13412345678',
            'vars' =&gt; '{&quot;%code%&quot;:&quot;123456&quot;}'
        );

        $sParamStr = &quot;&quot;;
        ksort($param);
        foreach ($param as $sKey =&gt; $sValue) {
            $sParamStr .= $sKey . '=' . $sValue . '&amp;';
        }

        $sParamStr = trim($sParamStr, '&amp;');
        $smskey = '***'
        $sSignature = md5($smskey.&quot;&amp;&quot;.$sParamStr.&quot;&amp;&quot;.$smskey);


        $param = array(
            'smsUser' =&gt; '***', 
            'templateId' =&gt; '1',
            'phone' =&gt; '13412345678',
            'vars' =&gt; '{&quot;%code%&quot;:&quot;123456&quot;}',
            'signature' =&gt; $sSignature
        );

        $data = http_build_query($param);
        echo $data;

        $options = array(
            'http' =&gt; array(
                'method' =&gt; 'POST',
                'header' =&gt; 'Content-Type:application/x-www-form-urlencoded',
                'content' =&gt; $data

        ));
        $context  = stream_context_create($options);
        $result = file_get_contents($url, FILE_TEXT, $context);

        return $result;
}

echo send_sms();
?&gt;
</code></pre>

<h3 id="ruby">Ruby</h3>
<pre><code>#!/usr/bin/env ruby

require 'rubygems'
require 'digest'
require 'rest_client'

def sorted_hash(aHash)
   return aHash.sort{|a,b| a.to_s &lt;=&gt; b.to_s}
end

def send_mail
        param = {
            &quot;smsUser&quot;=&gt; &quot;***&quot;, 
            &quot;templateId&quot;=&gt; &quot;1&quot;,
            &quot;phone&quot;=&gt; '13412345678',
            &quot;vars&quot;=&gt;'{&quot;%code%&quot;:&quot;123456&quot;}'  
        }
        api_key = &quot;***&quot;
        paramstr = &quot;&quot;
        paramstr &lt;&lt; api_key &lt;&lt; &quot;&amp;&quot;
        new_param = sorted_hash(param)
        new_param.each do |item|
            key = item[0]
            value = item[1]
            paramstr &lt;&lt; key &lt;&lt; &quot;=&quot; &lt;&lt; value &lt;&lt; &quot;&amp;&quot;
        end
        paramstr &lt;&lt; api_key

        md5 = Digest::MD5.new
        sign = md5.update(paramstr)

        response = RestClient.post &quot;http://sendcloud.sohu.com/smsapi/send?&quot;,
            :smsUser =&gt; &quot;***&quot;,
            :templateId =&gt; &quot;11&quot;,
            :phone =&gt; '13412345678',
            :vars =&gt;'{&quot;%code%&quot;:&quot;123456&quot;}',
            :signature =&gt; sign

return response
end

response = send_mail
puts response.code
puts response.to_str

</code></pre>

<h3 id="perl">Perl</h3>
<pre><code>use strict;
use LWP::UserAgent;
use HTTP::Request::Common;
use URI::Escape;
use Digest::MD5;

my $uri = 'http://sendcloud.sohu.com/smsapi/send';
my $ua = LWP::UserAgent-&gt;new;
my %param = (
    &quot;smsUser&quot; =&gt; '***',
    &quot;templateId&quot; =&gt; '1',
    &quot;phone&quot; =&gt; '13412345678', 
    &quot;vars&quot; =&gt; '{&quot;%code%&quot;:&quot;123456&quot;}');
my $api_key = &quot;***&quot;;
my $param_str = $api_key;

foreach my $item (sort keys %param){
    $param_str .= (&quot;&amp;&quot;.$item.&quot;=&quot;.$param{$item});
}
$param_str .= (&quot;&amp;&quot;.$api_key);

my $md5 = Digest::MD5-&gt;new;
$md5-&gt;add($param_str);
my $sign = $md5-&gt;hexdigest;

my $request = POST $uri,
    Content =&gt; [
        smsUser =&gt; '***', 
        templateId =&gt; '1',
        phone =&gt; '13412345678', 
        vars =&gt; '{&quot;%code%&quot;:&quot;123456&quot;}',
        signature =&gt; $sign
    ],
    Content_Type =&gt; 'application/x-www-form-urlencoded';

my $response = $ua-&gt;request($request) ;

if ($response-&gt;is_success()) {
    print $response-&gt;content, &quot;\n&quot;;
} else {
    print $response-&gt;as_string, &quot;\n&quot;;
}

exit;

</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../test/doc/" class="btn btn-neutral float-right" title="TRY IT">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../api/" class="btn btn-neutral" title="API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2017, Convertlab</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/xsio/open_api_docs" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../api/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../test/doc/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
