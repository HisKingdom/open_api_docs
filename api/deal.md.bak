##客户交易模型

DM Hub系统中所有交易信息都可以被记录下来。这里的交易可以是有订单发生的订单信息或没有订单行为的交易，如电话充值等。

通过客户交易接口，您可以将 交易成功 的订单导入DM Hub，也可以查询、修改和删除已经导入的订单。DM Hub会将导入的订单数据进行分析，您可以在导入后通过页面操作浏览，筛选，分析交易数据，也可以通过订单中的一些客户信息进行客户触达。

客户交易API包括查看所有订单API，增加订单API，修改订单API，查询订单API和删除订单API。这些API使用客户订单模型，如下所示。

<img src="/resources/deal1.png" width="600"/>

在模型中，每一个交易都会包含n个订单物品，交易和订单物品通过订单编号相关联。具体的模型结构如下。
- - -
|属性|属性意义|类型|说明|
|:---|:---|:---|:---|
|id|客户交易ID|Long|只读字段|
|customerId|客户id|Long|交易所属客户|
|orderNo|订单号|String|交易在对接系统中的订单号|
|amountTotal|订单总金额|BigDecimal|在交易中订单的总额，包括支付金额和优惠金额|
|amountPaid|实际支付金额|BigDecimal|客户支付金额|
|amountDiscount|优惠金额|BigDecimal|订单折扣|
|couponCode|优惠券|String|优惠券码|
|groupId|团购|String|团购id|
|paymentTerm|支付方式|String|现金、信用卡、微信支付、支付宝等支付方式|
|paymentNo|支付号|String|支付后的交易号码|
|type|订单类型|String|线上、线下等类型|
|dateOrder|订单时间|DateTime|订单支付完成时间，采用UTC时间格式为:“2017-06-07T12:20:20Z”|
|store|店铺|String|订单店铺（线下或线上的店铺名）|
|salesChannel|渠道|String|订单渠道（如线下，天猫等）|
|shippingMethod|运送方式|String|货物的运送方式|
|contactName|收货人名称|String|收货人名称|
|contactTel|收货人电话|String|收货人电话|
|shippingProvince|收货人省份|String|收货人省份|
|shippingCity|收货人城市|String|收货人城市|
|shippingCounty|收货人区县|String|收货人区县|
|shippingStreet|收货人街道|String|收货人街道|
|shippingAddress|收货人地址|String|收货人地址|

##订单物品模型

|属性|属性意义|类型|说明|
|:---|:---|:---|:---|
|orderNo|订单号|String|交易在对接系统中的订单号|
|productName|产品名称|String|产品名称|
|orderNo|订单号|String|交易在对接系统中的订单号|
|productName|产品名称 |String|产品名称|
|productId|产品的ID|String|产品ID|
|skuId|sku |id |String|Sku ID|
|category|产品所属品类| String|产品所属品类，比如啤酒|
|qty|订购数量 |Integer|订购数量|
|priceUnit |单件商品价格 |BigDecimal|单件商品价格|
|priceSubTotal|该商品总价|BigDecimal|该商品总价|





##创建业务订单的API

订单物品放在订单的line字段中一起创建。

**调用请求**
```
http请求方式：POST
https://api.convertlab.com/v1/deals?access_token=<access_token>

POST请求示例：
{
  "customerId": 8888,
  "orderNo": "11122233344455",
  "amountTotal": 69.0,
  "amountPaid": 59.0,
  "amountDiscount": 10,
  "counponCode": "222333444",
  "groupId": "888",
  "paymentTerm": "wechat",
  "paymentNo": "555666777",
  "type": "online",
  "dateOrder": "2017-04-20T12:56:47Z",
  "store": "CL官方商城",
  "salesChannel": "tmall",
  "shippingMethod": "zto",
  "contactName": "JH",
  "contactTel": "12399988877",
  "shippingProvince": "上海",
  "shippingCity": "上海",
  "shippingCounty": "徐汇区",
  "shippingStreet": "汇谷科技园",
  "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
  "lines": [
{
"productName": "啤酒6瓶装",
      "productId": "1497",
"skuId": "149766666",
"category": "啤酒",
      "qty": 1,
      "priceUnit": 69.0,
      "priceSubTotal": 69.0
    }
  ]
}

```
**参数说明**
- - -
|参数	|是否必填|	说明|
|:---|:---|:---|
|access_token	|是	|客户交易ID|
|customerId	|是	|客户id|
|orderNo	|是	|订单号|
|amountTotal	|否	|订单总金额|
|amountPaid	|是	|实际支付金额|
|amountDiscount	|否	|优惠金额|
|couponCode	|否	|优惠券|
|groupId	|否	|团购|
|paymentTerm	|否	|支付方式|
|paymentNo	|否	|支付号|
|type	|否	|订单类型|
|dateOrder	|是	|订单时间|
|store	|是	|店铺|
|salesChannel	|是	|渠道|
|shippingMethod	|否	|运送方式|
|contactName	|否	|收货人名称|
|contactTel	|否	|收货人电话|
|shippingProvince	|否	|收货人省份|
|shippingCity	|否	|收货人城市|
|shippingCounty	|否	|收货人区县|
|shippingStreet	|否	|收货人街道|
|shippingAddress	|否	|收货人地址|
|lines	|是	|订单物品|
|productName	|是	|产品名称|
|productId	|否	|产品ID|
|skuId	|否	|Sku ID|
|category	|否	|产品所属品类|
|qty	|是	|订购数量|
|priceUnit |否	|单件商品价格|
|priceSubTotal	|否	|该商品总价



**返回结果**
```
{
  "id": 1234,
  "customerId": 8888,
  "orderNo": "11122233344455",
  "amountTotal": 69.0,
  "amountPaid": 59.0,
  "amountDiscount": 10,
  "counponCode": "222333444",
  "groupId": "888",
  "paymentTerm": "wechat",
  "paymentNo": "555666777",
  "type": "online",
  "dateOrder": "2017-04-20T12:56:47Z",
  "store": "CL官方商城",
  "salesChannel": "tmall",
  "shippingMethod": "zto",
  "contactName": "JH",
  "contactTel": "12399988877",
  "shippingProvince": "上海",
  "shippingCity": "上海",
  "shippingCounty": "徐汇区",
  "shippingStreet": "汇谷科技园",
  "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
  "lines": [
{
"productName": "啤酒6瓶装",
      "productId": "1497",
"skuId": "149766666",
"category": "啤酒",
      "qty": 1,
      "priceUnit": 69.0,
      "priceSubTotal": 69.0
    }
  ]
}
```




##查询订单的API

**调用请求**

```
HTTP请求方法GET

https://api.convertlab.com/v1/deals/{id}?access_token={access_token}
```

**参数说明**
- - -
|参数|	是否必填|	说明|
|:---|:---|:---|
|access_token|	是|	请求凭证|


**返回数据**
```
{
  "id": 1234,
  "customerId": 8888,
  "orderNo": "11122233344455",
  "amountTotal": 69.0,
  "amountPaid": 59.0,
  "amountDiscount": 10,
  "counponCode": "222333444",
  "groupId": "888",
  "paymentTerm": "wechat",
  "paymentNo": "555666777",
  "type": "online",
  "dateOrder": "2017-04-20T12:56:47Z",
  "store": "CL官方商城",
  "salesChannel": "tmall",
  "shippingMethod": "zto",
  "contactName": "JH",
  "contactTel": "12399988877",
  "shippingProvince": "上海",
  "shippingCity": "上海",
  "shippingCounty": "徐汇区",
  "shippingStreet": "汇谷科技园",
  "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
  "lines": [
{
	"productName": "啤酒6瓶装",
        "productId": "1497",
	"skuId": "149766666",
	"category": "啤酒",
        "qty": 1,
        "priceUnit": 69.0,
        "priceSubTotal": 69.0
    }
  ]
}


```




##查询所有订单的API

**调用请求**
```
http请求方式：GET
https://api.convertlab.com/v1/deals?access_token={access_token}&rows={rows}&page={page}&sidx={sidx}&sord={sord}

```

**参数说明**
- - -
|参数	|是否必填	|说明|
|:---|:---|:---|
|access_token	|是	|请求凭证|
|rows	|否	|每页的记录数|
|page	|否	|起始页数，以1开始|
|sidx	|否	|排序的字段，默认按id排序|
|sord	|否	|asc表示升序，desc表示降序，默认为升序|


**返回结果**
```
{
  "page": 1,
  "records": 1,
  "rows": [
    {
      "id": 1234,
      "customerId": 8888,
      "orderNo": "11122233344455",
      "amountTotal": 69.0,
      "amountPaid": 59.0,
      "amountDiscount": 10,
      "counponCode": "222333444",
      "groupId": "888",
      "paymentTerm": "wechat",
      "paymentNo": "555666777",
      "type": "online",
      "dateOrder": "2017-04-20T12:56:47Z",
      "store": "CL官方商城",
      "salesChannel": "tmall",
      "shippingMethod": "zto",
      "contactName": "JH",
      "contactTel": "12399988877",
      "shippingProvince": "上海",
      "shippingCity": "上海",
      "shippingCounty": "徐汇区",
      "shippingStreet": "汇谷科技园",
      "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
      "lines": [
        {
          "productName": "啤酒6瓶装",
          "productId": "1497",
          "skuId": "149766666",
          "category": "啤酒",
          "qty": 1,
          "priceUnit": 69.0,
          "priceSubTotal": 69.0
        }
      ]
    }
  ]
```


##修改业务订单的API

所有订单相关字段均可以修改

**调用请求**
```
http请求方式：PUT
https://api.convertlab.com/v1/deals/{id}?access_token={access_token}

PUT请求示例：
{
  "contactName": "CL",
  "contactTel": "18566677788",
}

```

**参数说明**
- - -
|参数	|是否必填	|说明|
|:---|:---|:---|
|access_token	|是	|请求凭证|


**返回结果**
```
{
  "id": 1234,
  "customerId": 8888,
  "orderNo": "11122233344455",
  "amountTotal": 69.0,
  "amountPaid": 59.0,
  "amountDiscount": 10,
  "counponCode": "222333444",
  "groupId": "888",
  "paymentTerm": "wechat",
  "paymentNo": "555666777",
  "type": "online",
  "dateOrder": "2017-04-20T12:56:47Z",
  "store": "CL官方商城",
  "salesChannel": "tmall",
  "shippingMethod": "zto",
  "contactName": "CL",
  "contactTel": "18566677788",
  "shippingProvince": "上海",
  "shippingCity": "上海",
  "shippingCounty": "徐汇区",
  "shippingStreet": "汇谷科技园",
  "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
  "lines": [
{
      "productName": "啤酒6瓶装",
      "productId": "1497",
      "skuId": "149766666",
      "category": "啤酒",
      "qty": 1,
      "priceUnit": 69.0,
      "priceSubTotal": 69.0
    }
  ]
}
```


##删除业务订单的API

**调用请求**
```
http请求方式：DELETE
https://api.convertlab.com/v1/deals/{id}?access_token={access_token}
```

**参数说明**
- - - 
|参数	|是否必填	|说明|
|:---|:---|:---|
|access_token	|是	|请求凭证|


<!--
##创建订单事件的API

**调用请求**
```
HTTP请求方式: POST
https://api.convertlab.com/v1/customerevents?access_token={access_token}

POST数据示例:
{
  "attr1": 100,
  "attr2": "已成交",
  "attr3": "1",
  "attr4": "1",
  "customerId": 123456,
  "date": "2016-04-01T13:40:05Z",
  "event": "make_order",
  "targetId": "ORDER_ID_123",
  "targetName": "Coffee"
}

```
**参数说明**
- - -
|参数名|数据类型|说明|
|:---|:---|:---|
|attr1|number|订单金额|
|attr2|string|订单状态,默认"已提交"|
|attr3|string|宝贝数量|
|attr4|string|默认"1"|
|customerId|string|客户ID|
|event|string|事件类型,默认为"make_order"|
|targetId|string|订单Id|
|targetName|string|订单名称|

- - -
- {access_token}用从“获取身份权限”节拿到的access_token替换
- {id}是要更新订单的客户id

##批量订单导入的API

订单物品放在订单的line字段中一起创建。

**调用请求**

```
POST /v1/dealgroup?access_token={access_token}
POST数据示例:
{
    "deal": {
        "salesChannel": "tmall",
        "store": "科罗娜官方商城",
        "name": "931539319553230",
        "​amountDiscount": 10,
        "amountPaid": 59,
        "dateOrder": "2017-04-20T12:56:47Z",
        "amountTotal": 69,
        "couponUsed": true,
        "counponCode": "222333444",
        "productQuantity": 4,
        "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
        "contactName": "JH",                    //(推荐填写)
        "contactTel": "18502565886",            //(推荐填写)
        "lines": [
            {
                "priceUnit": 69,                //单位价格
                "priceSubTotal": 69,            //合计价格
                "qty": 1,                       //货品数量
                "discount": 0,                  //货品折扣
                "productId": 1497,              //产品ID
                "productName": "科罗娜啤酒6瓶装"  //产品名称
            }
        ]
    },
    "buyer": {
		"wechat": "string",
		"accountId": "string",
		"userName": "string",
		"mobile": "string",
		"email": "string",
		"emailVerified": true,
		"mobileVerified": true,
		"userId": 1234567,
		"type": "keluona"
    },
    "promotion": { //选填
        "discount":10.0,
        "giftItemId":"10",
        "giftItemName":"礼盒",
        "giftItemNum":1,
        "promotionName":"满100送礼盒",
        "promotionId":"5",
        "promotionDesc":"满100送礼盒"
    }
}
```
**参数说明**
- - -
|参数名|是否必填|说明|
|:---|:---|:---|
|salesChannel|ture|销售渠道|
|store|true|店铺名称|
|name|true|订单id|
|​amountDiscount|false|订单折扣金额|
|amountPaid|true|订单支付金额|
|dateOrder|true|订单日期|
|amountTotal|true|订单金额|
|couponUsed|false|优惠券是否使用|
|counponCode|false|优惠券号码|
|productQuantity|true|产品数量|
|shippingAddress|true|配送地址|
|contactName|false|收货人姓名|
|contactTel|false|收货人电话|

|wechat|false|在对应公众号的openid|
|accountId|false|填写公众号id|
|userName|true|买家在该商场的名称|
|mobile|false|买家电话|
|email|false|买家邮箱|
|emailVerified|false|是否验证邮箱|
|mobileVerified|false|是否验证手机号|
|userId|false|买家在该商场的id|
|type|false|买家类型|
|promotion|false|promotion|


##获取单个订单的API

**调用请求**
```
http请求方式：GET
https://api.convertlab.com/v1/deals/{id}?access_token={access_token}

```

**参数说明**
- - -
|参数	|是否必填	|说明|
|:---|:---|:---|
|access_token	|是	|请求凭证|


**返回结果**
```
{
  "id": 1234,
  "customerId": 8888,
  "orderNo": "11122233344455",
  "amountTotal": 69.0,
  "amountPaid": 59.0,
  "amountDiscount": 10,
  "counponCode": "222333444",
  "groupId": "888",
  "paymentTerm": "wechat",
  "paymentNo": "555666777",
  "type": "online",
  "dateOrder": "2017-04-20T12:56:47Z",
  "store": "CL官方商城",
  "salesChannel": "tmall",
  "shippingMethod": "zto",
  "contactName": "JH",
  "contactTel": "12399988877",
  "shippingProvince": "上海",
  "shippingCity": "上海",
  "shippingCounty": "徐汇区",
  "shippingStreet": "汇谷科技园",
  "shippingAddress": "上海市徐汇区汇谷科技园1幢605",
  "lines": [
{
"productName": "啤酒6瓶装",
      "productId": "1497",
"skuId": "149766666",
"category": "啤酒",
      "qty": 1,
      "priceUnit": 69.0,
      "priceSubTotal": 69.0
    }
  ]
}
```


**订单模型**
- - -
|参数名|数据类型|说明|
|:---|:---|:---|
|id|number|订单id|
|dateOrder|datetime string|订单日期|
|dateLastModify|datetime string|上次修改日期|
|amountTotal|number|订单金额|
|amountPaid|number|订单支付金额|
|amountTax|number|订单税额|
|amountReturn|number|订单退款金额|
|amountRefund|number|订单偿还金额|
|amountDiscount|number|订单折扣金额|
|couponCode|string|优惠券号码|
|couponUsed|boolean|优惠券是否使用|
|currency|string|币种|
|customerId|number|客户id|
|customerName|string|客户姓名|
|name|string|订单id|
|paymentTerm|string|支付方式|
|paymentNo|string|支付序列号|
|remark|string|备注|
|salesChannel|string|销售渠道|
|contactName|string|联系人|
|contactTel|string|联系人电话|
|state|string|支付状态|
|invoiceAddress|string|发票地址|
|shippingAddress|string|配送地址|
|shippingMethod|string|配送方式|
|shippingCity|string|配送城市|
|shippingCounty|string|配送县城|
|shippingProvince|string|配送省份|
|shippingStreet|string|配送街道|
|externalId|string|外部系统订单编号|
|externalInvoiceId|string|外部系统发票id|
|externalPickingId|string|外部系统拣货id|
|externalPartnerId|string|外部系统拣货id|
|groupId|string|群组id|
|paymentStatus|string|付款状态|
|deliveryStatus|string|发货状态|
|store|string|店铺名|
|userId|string|仓库|
|userName|string|仓库|
|lines|JSON object array|订单详情|


**订单行模型**
- - -
|参数名|数据类型|说明|
|:---|:---|:---|  
|category|number|种类|
|id|number|商品id|
|orderNo|number|订单号|
|priceSubTotal|number|合计价格|
|priceUnit|number|单位价格|
|qty|number|货品数量|
|discount|number|货品折扣|
|externalProductId|string|外部系统货品id| 
|productName|string|产品名称|
|productId|string|产品id|
|skuId|string|SKU|
|taskId|string|任务id|

-->











